#!/usr/bin/python3

import sys
import re
import urllib.parse

def decode_proofpoint_v2(url: str) -> str:
    """Decode a Proofpoint URL Defense v2 link into its original URL."""
    if "urldefense.proofpoint.com/v2/url" not in url:
        return url.strip()

    # Extract the u= parameter
    match = re.search(r"[?&]u=([^&]+)", url)
    if not match:
        return url.strip()

    encoded_url = match.group(1)

    # Replace "-XX" hex patterns with "%XX"
    encoded_url = re.sub(r'-([0-9A-F]{2})', r'%\1', encoded_url, flags=re.IGNORECASE)

    # Convert Proofpoint path markers
    encoded_url = encoded_url.replace('__', '://')
    encoded_url = encoded_url.replace('_', '/')

    # Decode percent escapes
    decoded_url = urllib.parse.unquote(encoded_url)
    return decoded_url.strip()

def main():
    for line in sys.stdin:
        line = line.strip()
        if line:
            print(decode_proofpoint_v2(line))

if __name__ == "__main__":
    main()
